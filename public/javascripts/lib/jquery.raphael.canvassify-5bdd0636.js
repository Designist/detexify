!function(e){function t(e,t){this.x=e,this.y=t,this.t=(new Date).getTime()}function a(e){var t=_.first(e),a=_.map(_.rest(e),function(e){return["L",e.x,e.y]});return 0==a.length?[["M",t.x,t.y],["l",0,.1]]:[["M",t.x,t.y]].concat(a)}Canvassified=function(n,i){var o,s,r=this,u={width:e(n).width(),height:e(n).height()},i=e.extend({},u,i),c=Raphael(n,i.width,i.height),h=!1;r.strokes=[];var p="dirty",g="pristine";e(n).addClass(g);var v=function(i){e(n).addClass(p),e(n).removeClass(g),i.preventDefault(),i.originalEvent&&i.originalEvent.preventDefault(),i.stopPropagation(),h=!0;var r,u;return pageX=i.originalEvent.touches?i.originalEvent.touches[0].pageX:i.pageX,pageY=i.originalEvent.touches?i.originalEvent.touches[0].pageY:i.pageY,r=pageX-e(n).offset().left,u=pageY-e(n).offset().top,o=[new t(r,u)],s=c.path(a(o)).attr({"stroke-width":5,"stroke-linecap":"round"}),!1},f=function(n){if(n.preventDefault(),n.originalEvent&&n.originalEvent.preventDefault(),n.stopPropagation(),h){var i,r;pageX=n.originalEvent.touches?n.originalEvent.touches[0].pageX:n.pageX,pageY=n.originalEvent.touches?n.originalEvent.touches[0].pageY:n.pageY,i=pageX-e(this).offset().left,r=pageY-e(this).offset().top,o.push(new t(i,r)),s.attr("path",a(o))}return!1},l=function(e){return e.preventDefault(),e.stopPropagation(),h&&(r.strokes.push(o),i.callback&&i.callback(r.strokes),h=!1),!1};e(n).mousedown(v).mousemove(f).mouseup(l).mouseleave(l).on("touchstart",v).on("touchend touchleave touchcancel",l).on("touchmove",f),r.clear=function(){e(n).removeClass(p),this.strokes=[],c.clear()}},e.canvassify=function(t,a){var t=e(t).get(0);return t.canvassified||(t.canvassified=new Canvassified(t,a))},e.fn.extend({canvassify:function(t){return e.canvassify(this,t),this}})}(jQuery);