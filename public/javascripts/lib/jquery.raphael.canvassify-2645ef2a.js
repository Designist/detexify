!function(e){function t(e,t){this.x=e,this.y=t,this.t=(new Date).getTime()}function n(e){var t=_.first(e),n=_.map(_.rest(e),function(e){return["L",e.x,e.y]});return 0==n.length?[["M",t.x,t.y],["l",0,.1]]:[["M",t.x,t.y]].concat(n)}Canvassified=function(a,i){var o,s,r=this,u={width:e(a).width(),height:e(a).height()},i=e.extend({},u,i),c=Raphael(a,i.width,i.height),h=!1;r.strokes=[];var g="dirty",p=function(i){e(a).addClass(g),i.preventDefault(),i.originalEvent&&i.originalEvent.preventDefault(),i.stopPropagation(),h=!0;var r,u;return pageX=i.originalEvent.touches?i.originalEvent.touches[0].pageX:i.pageX,pageY=i.originalEvent.touches?i.originalEvent.touches[0].pageY:i.pageY,r=pageX-e(a).offset().left,u=pageY-e(a).offset().top,o=[new t(r,u)],s=c.path(n(o)).attr({"stroke-width":5,"stroke-linecap":"round"}),!1},f=function(a){if(a.preventDefault(),a.originalEvent&&a.originalEvent.preventDefault(),a.stopPropagation(),h){var i,r;pageX=a.originalEvent.touches?a.originalEvent.touches[0].pageX:a.pageX,pageY=a.originalEvent.touches?a.originalEvent.touches[0].pageY:a.pageY,i=pageX-e(this).offset().left,r=pageY-e(this).offset().top,o.push(new t(i,r)),s.attr("path",n(o))}return!1},v=function(e){return e.preventDefault(),e.stopPropagation(),h&&(r.strokes.push(o),i.callback&&i.callback(r.strokes),h=!1),!1};e(a).mousedown(p).mousemove(f).mouseup(v).mouseleave(v).on("touchstart",p).on("touchend touchleave touchcancel",v).on("touchmove",f),r.clear=function(){e(a).removeClass(g),this.strokes=[],c.clear()}},e.canvassify=function(t,n){var t=e(t).get(0);return t.canvassified||(t.canvassified=new Canvassified(t,n))},e.fn.extend({canvassify:function(t){return e.canvassify(this,t),this}})}(jQuery);